C51 COMPILER V9.54   ESP8266                                                               04/19/2023 15:54:54 PAGE 1   


C51 COMPILER V9.54, COMPILATION OF MODULE ESP8266
OBJECT MODULE PLACED IN ..\Output\esp8266.obj
COMPILER INVOKED BY: D:\Keil5\C51\BIN\C51.EXE ..\Bank3\esp8266.c LARGE OBJECTADVANCED OPTIMIZE(8,SIZE) BROWSE INCDIR(..\
                    -FWLib\SC95F_Lib\inc;..\User;..\Bank1;..\Bank2;..\Bank3) DEFINE(SC95F8x3x) DEBUG PRINT(..\List\esp8266.lst) OBJECT(..\Out
                    -put\esp8266.obj)

line level    source

   1          #include "esp8266.h"
   2          #include "Delay.h"
   3          #include <string.h>
   4          #include <stdarg.h>
   5          #include "stdio.h"
   6          #include "..\Bank1\GUI.h"
   7          #include "..\Bank1\Lcd_Driver.h"
   8          #include "..\Bank2\Key.h"
   9          #include "..\Bank3\SHT30.h"
  10          
  11          char numbuf[6];
  12          extern char year;
  13          extern char month;
  14          extern char day;
  15          extern char hour;
  16          extern char minute;
  17          extern char second;
  18          char set_hour;
  19          char set_minute;
  20          char set_second;
  21          char set_numbuf[6];
  22          char clock_mode=0;
  23          
  24          void USCI2_SendByte(uint8_t Byte)
  25          {
  26   1              USCI2_UART_SendData8(Byte);
  27   1      }
  28          
  29          void USCI2_SendString(char* p)
  30          {
  31   1              while(*p !='\0')
  32   1              {
  33   2                      USCI2_SendByte(*p);
  34   2                      p++;
  35   2                      Delay_ms(10);
  36   2              }
  37   1      }
  38          
  39          char ESP8266_Cmd_Init() //esp8266 配置信息
  40          {
  41   1              USCI2_SendString("AT+RST\r\n");  ////esp8266重启指令
  42   1              Delay_ms(1000);
  43   1      
  44   1              USCI2_SendString("ATE0\r\n");  //关闭回显
  45   1              Delay_ms(2000);
  46   1              
  47   1              USCI2_SendString("AT+CWMODE=1\r\n");    // 设置工作模式 1 station模式  2 ap模式  3 station+ap模式
  48   1              Delay_ms(1000);
  49   1              
  50   1              USCI2_SendString("AT+CWJAP=\"WWW\",\"wyn62399\"\r\n");//输入路由器的账号密码
  51   1              Delay_ms(5000);
  52   1              
  53   1              USCI2_SendString("AT+CIPSTART=\"TCP\",\"api.k780.com\",88\r\n");
C51 COMPILER V9.54   ESP8266                                                               04/19/2023 15:54:54 PAGE 2   

  54   1              Delay_ms(1000);
  55   1              
  56   1              USCI2_SendString("AT+CIPMODE=1\r\n");   
  57   1              Delay_ms(1000);
  58   1      
  59   1              USCI2_SendString("AT+CIPSEND\r\n");
  60   1              Delay_ms(1000);
  61   1      
  62   1      //      USCI2_SendString("AT+RST\r\n");  ////esp8266重启指令
  63   1      //      Delay_ms(1000);
  64   1              
  65   1              return 0;
  66   1      }
  67          
  68          char ESP_get_data(void)
  69          {
  70   1              i=0;
  71   1              USCI2_SendString("GET http://api.k780.com:88/?app=life.time&appkey=10003&sign=b59bc3ef6191eb9f747dd4e83c9
             -9f2a4&format=json\r\n");//??・??μ?????       
  72   1              Delay_ms(1000);
  73   1              return 0;
  74   1      }
  75          
  76          void Parse_BJ_Time(void)
  77          {
  78   1              year=Recbuff[1];
  79   1              month=Recbuff[2];
  80   1              day=Recbuff[3];
  81   1              hour=Recbuff[4];
  82   1              minute=Recbuff[5];
  83   1              second=Recbuff[6];
  84   1      }
  85          
  86          void Clock_start_draw(void)
  87          {
  88   1              year=23;
  89   1              month=03;
  90   1              day=18;
  91   1              hour=10;
  92   1              minute=35;
  93   1              second=20;
  94   1      }
  95          
  96          void Clock_run(void)
  97          {
  98   1                      //显示年月日，时分秒
  99   1                      sprintf(numbuf,"%d,",(int)year);
 100   1                      Gui_DrawFont_GBK24(0,0,POINT_COLOR,BACK_COLOR,numbuf);
 101   1                      sprintf(numbuf,"%d,",(int)month);
 102   1                      Gui_DrawFont_GBK24(25,0,POINT_COLOR,BACK_COLOR,numbuf);
 103   1                      sprintf(numbuf,"%d",(int)day);
 104   1                      Gui_DrawFont_GBK24(50,0,POINT_COLOR,BACK_COLOR,numbuf);
 105   1                      sprintf(numbuf,"%d:",(int)hour);
 106   1                      Gui_DrawFont_GBK24(0,20,POINT_COLOR,BACK_COLOR,numbuf);
 107   1                      sprintf(numbuf,"%d:",(int)minute);
 108   1                      Gui_DrawFont_GBK24(25,20,POINT_COLOR,BACK_COLOR,numbuf);
 109   1                      if(second>=10)
 110   1                      {
 111   2                              sprintf(numbuf,"%d",(int)second);
 112   2                              Gui_DrawFont_GBK24(50,20,POINT_COLOR,BACK_COLOR,numbuf);
 113   2                      }
 114   1                      else 
C51 COMPILER V9.54   ESP8266                                                               04/19/2023 15:54:54 PAGE 3   

 115   1                      {
 116   2                              Gui_DrawFont_GBK24(50,20,POINT_COLOR,BACK_COLOR,"0");
 117   2                              sprintf(numbuf,"%d",(int)second);
 118   2                              Gui_DrawFont_GBK24(58,20,POINT_COLOR,BACK_COLOR,numbuf);
 119   2                      }
 120   1                      
 121   1                      SHT30_Read();                   //温湿度传感器信息获取
 122   1                      SHT30_Show();                   //温湿度传感器信息显示
 123   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    884    ----
   CONSTANT SIZE    =    244    ----
   XDATA SIZE       =     16       3
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
   EDATA SIZE       =   ----    ----
   HDATA SIZE       =   ----    ----
   XDATA CONST SIZE =   ----    ----
   FAR CONST SIZE   =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
